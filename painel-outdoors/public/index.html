<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Controle de Outdoors - Bi-semanas 2025</title>
  <link rel="icon" type="image/png" href="logo.png" />
  <style>
    body { margin: 0; font-family: Arial, sans-serif; display: flex; height: 100vh; background: #fff; color: #222; }
    #sidebar { width: 280px; background: #2c3e50; color: white; padding-top: 20px; box-sizing: border-box; overflow-y: auto; border-right: 1px solid #1a252f; }
    #sidebar h2 { display: flex; align-items: center; justify-content: center; margin-bottom: 20px; font-weight: normal; font-size: 18px; }
    #bisemanas-list { list-style: none; padding: 0 10px; margin: 0; }
    #bisemanas-list li { padding: 12px 10px; cursor: pointer; border-left: 4px solid transparent; user-select: none; transition: background 0.2s, border-color 0.2s; font-size: 14px; line-height: 1.3; white-space: normal; }
    #bisemanas-list li:hover { background: #34495e; }
    #bisemanas-list li.active { background: #2c3e50; border-left-color: #f39c12; font-weight: bold; color: white; }
    #bisemanas-list li.current-bisemana { background-color: #2980b9; border-left-color: #2980b9; font-weight: bold; color: white; }
    #content { flex-grow: 1; padding: 20px 30px; overflow-y: auto; display: flex; flex-direction: column; }
    h1 { margin-top: 0; margin-bottom: 20px; font-weight: normal; font-size: 24px; display: flex; align-items: center; }
    table { width: 100%; border-collapse: collapse; background: #fff; box-shadow: 0 0 10px rgba(0,0,0,0.08); margin-bottom: 20px; }
    th, td { padding: 8px 12px; border: 1px solid #ccc; font-size: 13px; text-align: left; }
    th { background: #2c3e50; color: white; }
    input[type="text"] { width: 100%; box-sizing: border-box; padding: 5px; font-size: 13px; }
    .status-toggle { cursor: pointer; padding: 5px 10px; border: none; border-radius: 4px; font-weight: bold; user-select: none; transition: background-color 0.3s; color: white; }
    #btn-gerar, #btn-reservar-multiplos {
      padding: 10px 20px;
      border: none;
      font-size: 15px;
      cursor: pointer;
      border-radius: 4px;
      color: white;
      margin-right: 10px;
    }
    #btn-gerar { background: #f39c12; }
    #btn-reservar-multiplos { background: #2980b9; }
    #tabs { margin-bottom: 15px; }
    #tabs button { background: #bdc3c7; border: none; padding: 8px 15px; cursor: pointer; font-size: 14px; margin-right: 10px; border-radius: 4px 4px 0 0; color: #2c3e50; font-weight: bold; }
    #tabs button.active { background: #f39c12; color: white; }
    #tables-container { flex-grow: 1; overflow-y: auto; }
    .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
    .modal-content { background: #fff; padding: 20px; border-radius: 8px; width: 300px; max-height: 90vh; overflow-y: auto; }
    .modal-content h3 { margin-top: 0; font-size: 18px; margin-bottom: 10px; }
    .modal-content label { display: block; margin-bottom: 5px; }
    .modal-content input[type="checkbox"] { margin-right: 8px; }
    .modal-content input[type="text"] { width: 100%; padding: 5px; margin: 10px 0; }
    .modal-buttons { display: flex; justify-content: space-between; margin-top: 10px; }
    .modal-buttons button { padding: 6px 12px; cursor: pointer; }
    #login-modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; }
    #login-modal .modal-content { width: 320px; }
    #login-modal h3 { margin-bottom: 15px; }
    #login-modal input[type="text"], #login-modal input[type="password"] { width: 100%; padding: 8px; margin-bottom: 10px; box-sizing: border-box; }
    #login-modal .login-buttons { display: flex; justify-content: space-between; align-items: center; }
    #login-modal button { padding: 8px 16px; cursor: pointer; border-radius: 4px; border: none; font-weight: bold; }
    #login-btn { background: #2980b9; color: white; }
    #whatsapp-btn { background: #25d366; color: white; display: flex; align-items: center; gap: 6px; }
    #whatsapp-btn svg { width: 18px; height: 18px; fill: white; }
  </style>
</head>
<body>
  <div id="modal" class="modal">
    <div class="modal-content">
      <h3>Marcar como Ocupado</h3>
      <label>Bi-semanas:</label>
      <div id="modal-checkboxes"></div>
      <label>Cliente:</label>
      <input type="text" id="modal-cliente" placeholder="Nome do cliente" />
      <div class="modal-buttons">
        <button id="modal-confirmar">Confirmar</button>
        <button id="modal-cancelar">Cancelar</button>
      </div>
    </div>
  </div>
  <div id="login-modal" class="modal">
    <div class="modal-content">
      <h3>Login para reservar placas</h3>
      <input type="text" id="login-username" placeholder="Usuário" autocomplete="username" />
      <input type="password" id="login-password" placeholder="Senha" autocomplete="current-password" />
      <div class="login-buttons">
        <button id="login-btn">Entrar</button>
        <button id="whatsapp-btn" title="Sem login? Fale comigo no WhatsApp">
          <svg viewBox="0 0 24 24"><path d="M20.5 3.5a10.4 10.4 0 0 0-15 14.4l-1.9 5.4 5.5-1.8a10.4 10.4 0 1 0 11.4-17zm-1.3 13.2c-.2.6-1.1 1.2-1.7 1.3-.5.1-1.1.2-2.2-.4-2.5-1.1-4.1-3.6-4.2-3.8-.1-.2-1-1.2-1-1.2s-.4-.5-.4-1.2c0-.6.4-.9.5-1 .2-.1.4-.1.5-.2.2 0 .4 0 .6.3.2.3.7 1.2.8 1.4.2.3.4.5.7.6.4.2.7.2 1.1.1.4-.1.9-.5 1.1-.7.3-.3.3-.5.3-.7 0-.2-.3-.5-.5-.7-.1-.1-.3-.2-.4-.4-.1-.2-.6-.9-.8-1.2-.2-.3-.3-.5-.4-.7-.1-.2 0-.4 0-.5 0-.1 0-.3.1-.4.1-.1.3-.3.4-.5.1-.1.1-.2 0-.3s-1-.4-1.3-.5c-.3-.2-.5-.2-.7-.3-.2-.1-.4-.2-.6-.2-.2 0-.3 0-.5.1-.2 0-.4.1-.6.3-.1.2-.3.3-.4.4-.1.1-.3.2-.4.3-.1.2-.2.4-.2.5 0 .1 0 .3.1.5.1.3.3.6.4.9.2.3.3.5.5.7.1.1.3.3.6.4.4.1.9.1 1.4.1.5 0 1.1 0 1.7-.1 1.2-.1 2.1-.3 2.9-1 .8-.6 1.3-1.6 1.5-2.3z"/></svg>
          WhatsApp
        </button>
      </div>
    </div>
  </div>
  <div id="sidebar">
    <h2>
      <img src="logo.png" alt="Logo" style="height: 30px; margin-right: 10px; vertical-align: middle;">
      Bi-semanas 2025
    </h2>
    <ul id="bisemanas-list"></ul>
  </div>
  <div id="content">
    <h1>
      <img src="logo.png" alt="Logo" style="height: 30px; margin-right: 10px; vertical-align: middle;">
      Controle de Outdoors
    </h1>
    <div id="tabs">
      <button id="tab-clientes" class="active">Clientes</button>
      <button id="tab-fornecedores">Fornecedores</button>
    </div>
    <label for="filtroStatus">Filtro Status:</label>
    <select id="filtroStatus" style="margin-bottom: 15px; font-size: 14px; padding: 5px;">
      <option value="todos">Todos</option>
      <option value="ocupados">Ocupados</option>
      <option value="disponiveis">Disponíveis</option>
    </select>
    <div id="tables-container"></div>
    <div style="margin-bottom: 20px;">
      <button id="btn-gerar">Gerar PDF</button>
      <button id="btn-reservar-multiplos">Reservar Selecionadas</button>
    </div>
  </div>
<script>
(async function(){
  const bisemanas = Array.from({length:26}, (_,i) => String(2 + i*2).padStart(2,'0'));
  let statusData = {};
  let clientesData = {};
  let fornecedoresData = {};
  let outdoors = [];

  const bisemanasList = document.getElementById('bisemanas-list');
  const tablesContainer = document.getElementById('tables-container');
  const btnGerar = document.getElementById('btn-gerar');
  const btnReservarMultiplos = document.getElementById('btn-reservar-multiplos');
  const filtroStatus = document.getElementById('filtroStatus');
  const tabClientesBtn = document.getElementById('tab-clientes');
  const tabFornecedoresBtn = document.getElementById('tab-fornecedores');

  let biSelecionada = biAtual();
  let tabAtual = 'clientes';

  // Função para achar a primeira segunda-feira da semana 1 ISO
  function primeiraSegundaDaSemana1(ano){
    const jan4 = new Date(ano, 0, 4);
    const diaSemana = jan4.getDay() || 7; // domingo=0 para 7
    return new Date(ano, 0, 4 - (diaSemana - 1));
  }

  // Calcula bi-semana atual
  function biAtual(){
    const hoje = new Date();
    const ano = hoje.getFullYear();
    if (ano !== 2025) return bisemanas[0];
    const primeiraSegunda = primeiraSegundaDaSemana1(ano);
    const diffDias = Math.floor((hoje - primeiraSegunda) / (1000*60*60*24));
    if(diffDias < 0) return bisemanas[0];
    const bi = 2 + Math.floor(diffDias / 14) * 2;
    const biStr = String(bi).padStart(2,'0');
    return bisemanas.includes(biStr) ? biStr : bisemanas[bisemanas.length -1];
  }

  function salvarLocalStorage(){
    localStorage.setItem('statusData', JSON.stringify(statusData));
    localStorage.setItem('clientesData', JSON.stringify(clientesData));
    localStorage.setItem('fornecedoresData', JSON.stringify(fornecedoresData));
  }

  function carregarLocalStorage(){
    try {
      statusData = JSON.parse(localStorage.getItem('statusData')) || {};
      clientesData = JSON.parse(localStorage.getItem('clientesData')) || {};
      fornecedoresData = JSON.parse(localStorage.getItem('fornecedoresData')) || {};
    } catch(e){
      statusData = {};
      clientesData = {};
      fornecedoresData = {};
    }
  }

  // Exemplo de outdoors com id, endereço, etc - você deve substituir por seus dados reais
  outdoors = [
    { id: 1, endereco: "Av. Principal, 100" },
    { id: 2, endereco: "Rua Secundária, 234" },
    { id: 3, endereco: "Praça Central, 55" },
    { id: 4, endereco: "Av. Brasil, 777" },
    { id: 5, endereco: "Rua das Flores, 101" }
    // ... completar com todos os outdoors
  ];

  function criarListaBisemanas(){
    bisemanasList.innerHTML = '';
    bisemanas.forEach(bi => {
      const li = document.createElement('li');
      li.textContent = bi;
      li.dataset.bi = bi;
      if(bi === biSelecionada) li.classList.add('active');
      if(bi === biAtual()) li.classList.add('current-bisemana');
      li.addEventListener('click', ()=>{
        biSelecionada = bi;
        atualizarListaBisemanas();
        renderTabela();
      });
      bisemanasList.appendChild(li);
    });
  }
  function atualizarListaBisemanas(){
    bisemanasList.querySelectorAll('li').forEach(li=>{
      li.classList.toggle('active', li.dataset.bi === biSelecionada);
      li.classList.toggle('current-bisemana', li.dataset.bi === biAtual());
    });
  }

  function criarTabelaOutdoor(outdoor, tipo){
    // tipo: 'clientes' ou 'fornecedores'
    const tr = document.createElement('tr');
    tr.dataset.outdoorId = outdoor.id;

    const tdEndereco = document.createElement('td');
    tdEndereco.textContent = outdoor.endereco;
    tr.appendChild(tdEndereco);

    const tdStatus = document.createElement('td');
    const status = statusData[outdoor.id]?.[biSelecionada] || 'disponivel';
    const btnStatus = document.createElement('button');
    btnStatus.className = 'status-toggle';
    btnStatus.textContent = status === 'ocupado' ? 'Ocupado' : 'Disponível';
    btnStatus.style.backgroundColor = status === 'ocupado' ? '#e74c3c' : '#27ae60';
    btnStatus.addEventListener('click', ()=> abrirModal(outdoor.id));
    tdStatus.appendChild(btnStatus);
    tr.appendChild(tdStatus);

    const tdCliente = document.createElement('td');
    const cliente = (tipo === 'clientes') ? (clientesData[outdoor.id]?.[biSelecionada] || '') : (fornecedoresData[outdoor.id]?.[biSelecionada] || '');
    const inputCliente = document.createElement('input');
    inputCliente.type = 'text';
    inputCliente.value = cliente;
    inputCliente.disabled = (status !== 'ocupado');
    inputCliente.addEventListener('change', (e)=>{
      if(tipo === 'clientes'){
        if(!clientesData[outdoor.id]) clientesData[outdoor.id] = {};
        clientesData[outdoor.id][biSelecionada] = e.target.value.trim();
      } else {
        if(!fornecedoresData[outdoor.id]) fornecedoresData[outdoor.id] = {};
        fornecedoresData[outdoor.id][biSelecionada] = e.target.value.trim();
      }
      salvarLocalStorage();
    });
    tdCliente.appendChild(inputCliente);
    tr.appendChild(tdCliente);

    return tr;
  }

  function renderTabela(){
    tablesContainer.innerHTML = '';
    const tabela = document.createElement('table');
    const thead = document.createElement('thead');
    const trHead = document.createElement('tr');
    ['Endereço', 'Status', tabAtual === 'clientes' ? 'Cliente' : 'Fornecedor'].forEach(text => {
      const th = document.createElement('th');
      th.textContent = text;
      trHead.appendChild(th);
    });
    thead.appendChild(trHead);
    tabela.appendChild(thead);

    const tbody = document.createElement('tbody');
    let dadosFiltro = outdoors;

    // Filtrar por status
    if(filtroStatus.value === 'ocupados') {
      dadosFiltro = outdoors.filter(o => (statusData[o.id]?.[biSelecionada] === 'ocupado'));
    } else if(filtroStatus.value === 'disponiveis') {
      dadosFiltro = outdoors.filter(o => !statusData[o.id]?.[biSelecionada] || statusData[o.id][biSelecionada] !== 'ocupado');
    }

    dadosFiltro.forEach(outdoor => {
      tbody.appendChild(criarTabelaOutdoor(outdoor, tabAtual));
    });

    tabela.appendChild(tbody);
    tablesContainer.appendChild(tabela);
  }

  // Modal para marcar múltiplas bi-semanas
  const modal = document.getElementById('modal');
  const modalCheckboxes = document.getElementById('modal-checkboxes');
  const modalClienteInput = document.getElementById('modal-cliente');
  const modalConfirmar = document.getElementById('modal-confirmar');
  const modalCancelar = document.getElementById('modal-cancelar');
  let outdoorAtualModal = null;

  function abrirModal(outdoorId){
    outdoorAtualModal = outdoorId;
    modalCheckboxes.innerHTML = '';
    bisemanas.forEach(bi=>{
      const label = document.createElement('label');
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.value = bi;
      // marca as bi-semanas já ocupadas para aquele outdoor
      if(statusData[outdoorId]?.[bi] === 'ocupado') checkbox.checked = true;
      label.appendChild(checkbox);
      label.appendChild(document.createTextNode(bi));
      modalCheckboxes.appendChild(label);
    });
    modalClienteInput.value = clientesData[outdoorId]?.[biSelecionada] || '';
    modal.style.display = 'flex';
  }
  modalCancelar.onclick = () => { modal.style.display = 'none'; outdoorAtualModal = null; };
  modalConfirmar.onclick = () => {
    if(!outdoorAtualModal) return;
    const checkedBisemanas = Array.from(modalCheckboxes.querySelectorAll('input[type=checkbox]:checked')).map(cb=>cb.value);
    const clienteNome = modalClienteInput.value.trim();
    if(checkedBisemanas.length === 0) {
      alert('Selecione ao menos uma bi-semana.');
      return;
    }
    if(clienteNome === '') {
      alert('Informe o nome do cliente.');
      return;
    }
    checkedBisemanas.forEach(bi=>{
      if(!statusData[outdoorAtualModal]) statusData[outdoorAtualModal] = {};
      statusData[outdoorAtualModal][bi] = 'ocupado';
      if(!clientesData[outdoorAtualModal]) clientesData[outdoorAtualModal] = {};
      clientesData[outdoorAtualModal][bi] = clienteNome;
    });
    // remover ocupação das bi-semanas não marcadas
    bisemanas.forEach(bi=>{
      if(!checkedBisemanas.includes(bi)){
        if(statusData[outdoorAtualModal]) delete statusData[outdoorAtualModal][bi];
        if(clientesData[outdoorAtualModal]) delete clientesData[outdoorAtualModal][bi];
      }
    });
    salvarLocalStorage();
    modal.style.display = 'none';
    outdoorAtualModal = null;
    renderTabela();
  };

  filtroStatus.addEventListener('change', renderTabela);
  tabClientesBtn.addEventListener('click', ()=>{
    tabAtual = 'clientes';
    tabClientesBtn.classList.add('active');
    tabFornecedoresBtn.classList.remove('active');
    renderTabela();
  });
  tabFornecedoresBtn.addEventListener('click', ()=>{
    tabAtual = 'fornecedores';
    tabClientesBtn.classList.remove('active');
    tabFornecedoresBtn.classList.add('active');
    renderTabela();
  });

  // Geração simples de PDF via jsPDF (biblioteca deve ser incluída para funcionar)
  btnGerar.addEventListener('click', ()=>{
    alert('Função gerar PDF ainda não implementada.');
  });

  btnReservarMultiplos.addEventListener('click', ()=>{
    const checkboxes = tablesContainer.querySelectorAll('tbody input[type="checkbox"]:checked');
    if(checkboxes.length === 0){
      alert('Selecione ao menos uma placa para reservar.');
      return;
    }
    alert('Reserva múltipla não implementada nesta versão.');
  });

  // Carregar e iniciar
  carregarLocalStorage();
  criarListaBisemanas();
  renderTabela();

  // Login modal (simplificado)
  const loginModal = document.getElementById('login-modal');
  const loginBtn = document.getElementById('login-btn');
  const whatsappBtn = document.getElementById('whatsapp-btn');

  // Exemplo: sempre logado para simplificar
  let logado = true;
  // Caso queira implementar login, deve controlar aqui

  whatsappBtn.addEventListener('click', ()=>{
    window.open('https://wa.me/5599999999999', '_blank');
  });

})();
</script>
</body>
</html>
